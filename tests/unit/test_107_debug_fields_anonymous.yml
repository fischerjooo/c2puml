test:
  name: Debug Nested Anonymous Structure Fields
  id: '107'
  description: Validate nested anonymous structure field parsing and naming conventions
---
source_files:
  anonymous_fields.c: |
    typedef struct {
        int id;
        struct {
            char label[32];
            union {
                int int_val;
                float float_val;
            };  // Anonymous union within anonymous struct
            double precision;
        } config;  // Named anonymous struct field
        union {
            struct {
                int width;
                int height;
            } dimensions;  // Named struct within anonymous union
            long area;
        };  // Anonymous union
    } container_t;

    void setup_container(container_t* c) {
        c->id = 1;
        c->config.precision = 1.0;
        c->dimensions.width = 800;
    }

    container_t global_container = {0};
---
config.json: |
  {
    "project_name": "debug_nested_anonymous_structure_fields",
    "source_folders": ["."],
    "output_dir": "./output",
    "recursive_search": true
  }
---
assertions:
  execution:
    exit_code: 0
  model:
    validate_structure: true
    expected_files:
      - anonymous_fields.c
    structs_exist:
    - container_t
    - container_t_config
    - __anonymous_struct__
    - __anonymous_union___dimensions
    unions_exist:
    - __anonymous_union__
    - container_t_dimensions
    functions_exist:
    - setup_container
    globals_exist:
    - global_container
    struct_details:
      __anonymous_union___dimensions:
        fields:
        - width
        - height
    element_counts:
      structs: 4
      unions: 2
      functions: 1
      globals: 1
      aliases: 0
  puml:
    syntax_valid: true
    contains_elements:
    - container_t
    - setup_container
    - global_container
    contains_lines:
    - void setup_container(container_t * c)
    - + int id
    - + container_t_config config
    - + container_t_dimensions dimensions
    - + long area
    - + int int_val
    - + float float_val
    - + int width
    - + int height
    - container_t global_container
    class_count: 7
    relationship_count: 6
  files:
    output_dir_exists: ./output
    files_exist:
      - ./output/model.json
      - ./output/model_transformed.json

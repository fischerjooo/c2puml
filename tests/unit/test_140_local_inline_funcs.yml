test:
  name: Parser â€“ LOCAL_INLINE Function Detection
  description: Test that LOCAL_INLINE functions are correctly parsed and detected as inline in both source and header files
  category: unit
  id: '140'
---
source_files:
  local_inline_test.c: |
    // Test LOCAL_INLINE function detection in source files
    #include "local_inline_test.h"
    
    // Regular function
    void regular_func(int x) { (void)x; }
    
    // Standard inline function
    inline void standard_inline_func(int x) { (void)x; }
    
    // LOCAL_INLINE function in source file
    LOCAL_INLINE void local_inline_func(int x) { (void)x; }
    
    // LOCAL_INLINE with return type
    LOCAL_INLINE int local_inline_compute(int a, int b) { return a + b; }
    
    // Mixed modifiers with LOCAL_INLINE
    static LOCAL_INLINE void static_local_inline_func(void) {}
    
    // LOCAL_INLINE with complex return type
    LOCAL_INLINE const char * local_inline_get_name(void) { return "test"; }
    
    // Implementation of header function
    void header_regular_func(void) { /* implementation */ }
  
  local_inline_test.h: |
    // Test LOCAL_INLINE function detection in header files
    #ifndef LOCAL_INLINE_TEST_H
    #define LOCAL_INLINE_TEST_H
    
    // LOCAL_INLINE function in header file (this was the bug - not showing in PlantUML)
    LOCAL_INLINE void header_inline_func(void * param1, int * param2) {
        (void)*param1;
        (void)*param2;
    }
    
    // LOCAL_INLINE with return type in header
    LOCAL_INLINE int header_inline_compute(int a, int b) {
        return a + b;
    }
    
    // Regular function declaration
    void header_regular_func(void);
    
    #endif
---
config.json: |
  {
    "project_name": "local_inline_test",
    "source_folders": ["."],
    "output_dir": "./output",
    "recursive_search": true,
    "include_depth": 2
  }
---
assertions:
  execution:
    exit_code: 0
    output_files:
    - model.json
    - model_transformed.json
    - local_inline_test.puml
  model:
    files:
      local_inline_test.c:
        functions:
        - regular_func
        - standard_inline_func
        - local_inline_func
        - local_inline_compute
        - static_local_inline_func
        - local_inline_get_name
        - header_regular_func
        function_properties:
          regular_func:
            is_inline: false
          standard_inline_func:
            is_inline: true
          local_inline_func:
            is_inline: true
          local_inline_compute:
            is_inline: true
          static_local_inline_func:
            is_inline: true
          local_inline_get_name:
            is_inline: true
          header_regular_func:
            is_inline: false
      local_inline_test.h:
        functions:
        - header_inline_func
        - header_inline_compute
        - header_regular_func
        function_properties:
          header_inline_func:
            is_inline: true
            is_declaration: false
          header_inline_compute:
            is_inline: true
            is_declaration: false
          header_regular_func:
            is_declaration: true
  puml:
    syntax_valid: true
    files:
      local_inline_test.puml:
        contains_elements:
        - regular_func
        - standard_inline_func
        - local_inline_func
        - local_inline_compute
        - static_local_inline_func
        - local_inline_get_name
        - header_regular_func
        - header_inline_func
        - header_inline_compute
        contains_lines:
        - "regular_func("
        - "standard_inline_func("
        - "local_inline_func("
        - "local_inline_compute("
        - "static_local_inline_func("
        - "local_inline_get_name("
        - "header_regular_func("
        # Test the fix: LOCAL_INLINE functions in headers should appear with clean return types
        - "+ void header_inline_func(void * param1, int * param2)"
        - "+ int header_inline_compute(int a, int b)"
        # Test that LOCAL_INLINE keyword is removed from return type in headers
        not_contains_lines:
        - "LOCAL_INLINE void header_inline_func"
        - "LOCAL_INLINE int header_inline_compute"
  files:
    output_dir_exists: ./output
    files_exist:
      - ./output/model.json
      - ./output/model_transformed.json
      - ./output/local_inline_test.puml
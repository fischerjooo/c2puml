---
test:
  name: "generator_exact_format_cli_requested_format"
  description: "Test the exact format requested: public functions, empty line, private functions"
  category: "generator"
  
---
source_files:
  model.json: |
    {
      "project_name": "test_project",
      "source_folder": "/test",
      "files": {
        "example.c": {
          "file_path": "example.c",
          "name": "example.c",
          "includes": [],
          "macros": [],
          "enums": {},
          "structs": {},
          "unions": {},
          "aliases": {},
          "functions": [
            {
              "name": "Init",
              "return_type": "void",
              "is_declaration": false,
              "parameters": []
            },
            {
              "name": "HelperFunction",
              "return_type": "void",
              "is_declaration": false,
              "parameters": []
            },
            {
              "name": "Calculate",
              "return_type": "int",
              "is_declaration": false,
              "parameters": []
            },
            {
              "name": "InternalComputation",
              "return_type": "static int",
              "is_declaration": false,
              "parameters": []
            },
            {
              "name": "Shutdown",
              "return_type": "void",
              "is_declaration": false,
              "parameters": []
            }
          ],
          "globals": []
        },
        "example.h": {
          "file_path": "example.h",
          "name": "example.h",
          "includes": [],
          "macros": [],
          "enums": {},
          "structs": {},
          "unions": {},
          "aliases": {},
          "functions": [
            {
              "name": "Init",
              "return_type": "void",
              "is_declaration": true,
              "parameters": []
            },
            {
              "name": "Calculate",
              "return_type": "int",
              "is_declaration": true,
              "parameters": []
            },
            {
              "name": "Shutdown",
              "return_type": "void",
              "is_declaration": true,
              "parameters": []
            }
          ],
          "globals": []
        }
      },
      "include_relations": []
    }

---
config.json: |
  {
    "project_name": "test_project",
    "source_folders": ["src"],
    "output_dir": "output",
    "plantuml_jar_path": "/app/tools/plantuml-1.2024.8.jar",
    "use_short_names": false,
    "group_by_visibility": true
  }

---
assertions:
  execution:
    exit_code: 0
  puml:
    example.c.puml:
      contains:
        - "+ void Init()"
        - "+ int Calculate()"
        - "+ void Shutdown()"
        - "- void HelperFunction()"
        - "- static int InternalComputation()"
        - "-- Functions --"
      # Test for exact sequence: public functions, empty line, private functions
      regex_matches:
        - pattern: "\\+[^\\-]*\\n\\s*\\n[^\\+]*\\-"
          description: "Empty line between public and private function groups"
      # Test that no private functions appear before empty line and no public after
      regex_not_matches:
        - pattern: "\\-[^\\n]*\\n[^\\n]*\\+"
          description: "Should not have private function followed by public function"
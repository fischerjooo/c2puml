# Test metadata
test:
  name: "Debug Nested Struct Parsing"
  description: "Test parsing nested struct definitions for debugging purposes"
  category: "unit"
  id: "0092"

---
# Source files
source_files:
  nested_struct.c: |
    typedef struct {
        int outer_id;
        struct {
            char name[32];
            struct {
                float x, y, z;
            } position;
        } inner_data;
        double outer_value;
    } nested_struct_t;
    
    // Function using the nested struct
    void process_nested(nested_struct_t* ns) {
        // Processing function
    }

---
# Configuration
config.json: |
  {
    "project_name": "debug_nested_struct_parsing",
    "source_folders": ["."],
    "output_dir": "./output",
    "recursive_search": true
  }

---
# Assertions
assertions:
  execution:
    exit_code: 0
    output_files: ["model.json", "model_transformed.json", "nested_struct.puml"]
  
  model:
    validate_structure: true
    project_name: "debug_nested_struct_parsing"
    expected_files: ["nested_struct.c"]
    
    # Validate struct parsing with anonymous processing
    structs_exist: ["nested_struct_t"]
    functions_exist: ["process_nested"]
    
    # Validate struct field details
    struct_details:
      nested_struct_t:
        fields: ["outer_id", "inner_data", "outer_value"]
    
    # Validate function details
    function_details:
      process_nested:
        return_type: "void"
        parameters: ["nested_struct_t*"]
    
    # Validate element counts
    element_counts:
      structs: 4  # nested_struct_t + 3 anonymous structs become named
      functions: 1
      aliases: 0  # typedef struct creates struct, not alias
  
  puml:
    syntax_valid: true
    file_count: 1
    
    files:
      nested_struct.puml:
        contains_elements: ["nested_struct_t", "process_nested"]
        contains_lines: ["void process_nested(nested_struct_t * ns)"]
        class_count: 5  # source + 4 struct classes (including anonymous)
        relationship_count: 4  # 2 declaration + 2 composition relationships
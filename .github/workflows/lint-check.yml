name: Lint and Format Check (No Auto-commit)

on:
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:

jobs:
  lint-check:
    runs-on: ubuntu-latest
    strategy:
      matrix:
        python-version: [3.9]

    steps:
    - uses: actions/checkout@v4

    - name: Set up Python ${{ matrix.python-version }}
      uses: actions/setup-python@v5
      with:
        python-version: ${{ matrix.python-version }}

    - name: Install dependencies
      run: |
        echo "ğŸ”§ Installing Python dependencies..."
        python -m pip install --upgrade pip
        echo "ğŸ“¦ Installing linting and formatting tools..."
        pip install flake8 black isort
        echo "ğŸ“‹ Installing package in development mode..."
        pip install -e .
        echo "âœ… Dependencies installed successfully"

    - name: Show Python environment
      run: |
        echo "ğŸ Python Environment Information:"
        echo "Python version: $(python --version)"
        echo "Pip version: $(pip --version)"
        echo "Installed packages:"
        pip list

    - name: Check code formatting with black
      run: |
        echo "ğŸ¨ Checking code formatting with black..."
        black --check --diff c_to_plantuml/ main.py run_all_tests.py setup.py
        echo "âœ… Black formatting check completed"

    - name: Check import sorting with isort
      run: |
        echo "ğŸ“¦ Checking import sorting with isort..."
        isort --check-only --diff c_to_plantuml/ main.py run_all_tests.py setup.py
        echo "âœ… isort check completed"

    - name: Lint with flake8
      run: |
        echo "ğŸ” Running comprehensive flake8 linting..."
        flake8 c_to_plantuml/ main.py run_all_tests.py setup.py \
          --count \
          --select=E9,F63,F7,F82,W291,W292,W293,W391,E201,E202,E203,E211,E221,E222,E223,E224,E225,E226,E227,E228,E231,E241,E242,E251,E261,E262,E265,E266,E271,E272,E273,E274,E275,E301,E302,E303,E304,E305,E306,E401,E402,E701,E702,E703,E711,E712,E713,E714,E721,E722,E731,E741,E742,E743,E901,E902,W191,W291,W292,W293,W391,W503,W504,W601,W602,W603,W604,W605,W606 \
          --show-source \
          --statistics \
          --max-line-length=88 \
          --extend-ignore=E203,W503,E501
        echo "âœ… flake8 linting completed"